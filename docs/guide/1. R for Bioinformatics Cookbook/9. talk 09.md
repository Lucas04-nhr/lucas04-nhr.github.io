---
title: Data visualisation
createTime: 2025/12/07 21:59:34
permalink: /docs/r-course/talk09/
---

# Talk 09 {#talk09}

::: note
Reference: [R for Data Science](https://r4ds.had.co.nz)

The book updated to 2^nd^ ed. on July,2023, here’ s a [link](https://r4ds.hadley.nz) to the official website.

  ::: flex around center
  <LinkCard 
    icon="ic:outline-description"
    title="View the original slide"
    href="https://github.com/Lucas04-nhr/R-for-Data-Science/blob/main/talk09.pdf" > 
  </LinkCard>

  <LinkCard 
    icon="ic:round-document-scanner"
    title="View the original Rmd file"
    href="https://github.com/Lucas04-nhr/R-for-Data-Science/blob/main/talk09.Rmd" > 
  </LinkCard>
  :::
  
:::

## Basic plot functions using R {#basic-plot-functions}

### Dot plot {#dot-plot}

```R
with( 
  swiss, 
  plot(
    Education, 
    Fertility,
    type = "p", 
    main = "Swiss data 1888", 
    sub = "Socioeconomic indicators & Fertility", 
    xlab = "Education", 
    ylab = "Fertility", 
    col = "darkblue", 
    xlim = range( Education ), 
    ylim = range( Fertility ), 
    pch = 20, 
    frame.plot = F
  ) 
)
```

::: center
![Dot plot](https://cdn.jsdelivr.net/gh/Lucas04-nhr/Pictures@main/uPic/image-20231212160107785.png)
:::

**Function usage:**

```R
## Default S3 method:
plot(
  x, 
  y = NULL, 
  type = "p", 
  xlim = NULL, ylim = NULL,
  log = "", 
  main = NULL, sub = NULL, 
  xlab = NULL, ylab = NULL,
  ann = par("ann"), axes = TRUE, frame.plot = axes,
  panel.first = NULL, panel.last = NULL, asp = NA,
  xgap.axis = NA, ygap.axis = NA,
  ...
)
# Default Parameters are listed.
```

**Arguments**

|        Parameters        |                           Details                            |
| :----------------------: | :----------------------------------------------------------: |
|         `x`, `y`         | the `x` and `y` arguments provide the x and y coordinates for the plot. Any reasonable way of defining the coordinates is acceptable. See the function `xy.coords` for details. If supplied separately, they must be of the same length. |
|          `type`          | 1-character string giving the type of plot desired. The following values are possible, for details, see `plot`: `"p"` for points, `"l"` for lines, `"b"` for both points and lines, `"c"` for empty points joined by lines, `"o"` for overplotted points and lines, `"s"` and `"S"` for stair steps and `"h"` for histogram-like vertical lines. Finally, `"n"` does not produce any points or lines. |
|          `xlim`          | the x limits (x1, x2) of the plot. Note that `x1 > x2` is allowed and leads to a ‘reversed axis’.The default value, `NULL`, indicates that the range of the finite values to be plotted should be used. |
|          `ylim`          |                  the y limits of the plot.                   |
|          `log`           | a character string which contains `"x"` if the x axis is to be logarithmic, `"y"` if the y axis is to be logarithmic and `"xy"` or `"yx"` if both axes are to be logarithmic. |
|          `main`          |         a main title for the plot, see also `title`.         |
|          `sub`           |                   a subtitle for the plot.                   |
|          `xlab`          |  a label for the x axis, defaults to a description of `x`.   |
|          `ylab`          |  a label for the y axis, defaults to a description of `y`.   |
|          `ann`           | a logical value indicating whether the default annotation (title and x and y axis labels) should appear on the plot. |
|          `axes`          | a logical value indicating whether both axes should be drawn on the plot. Use graphical parameter `"xaxt"` or `"yaxt"` to suppress just one of the axes. |
|       `frame.plot`       | a logical indicating whether a box should be drawn around the plot. |
|      `panel.first`       | an ‘expression’ to be evaluated after the plot axes are set up but before any plotting takes place. This can be useful for drawing background grids or scatterplot smooths. Note that this works by lazy evaluation: passing this argument from other `plot` methods may well not work since it may be evaluated too early. |
|       `panel.last`       | an expression to be evaluated after plotting has taken place but before the axes, title and box are added. See the comments about `panel.first`. |
|          `asp`           |          the `y/x` aspect ratio, see `plot.window`.          |
| `xgap.axis`, `ygap.axis` | the `x/y` axis gap factors, passed as `gap.axis` to the two `axis()` calls (when `axes` is true, as per default). |

::: tip
You can also use `ggplot` to draw the plot above:

```R
ggplot( 
  swiss, 
  aes(x = Education, y = Fertility) 
) + 
geom_point() + 
scale_x_log10() + 
scale_y_log10() + 
xlab("Education") + 
ylab("Fertility") + 
ggtitle ("Swiss data 1888")

```
:::

### High-level and low-level plots {#high-level-and-low-level-plots}

::: tip
- **high level**: plotting functions create a new plot on the graphics device
- **low level**: plotting functions add more information to an existing plot
:::

#### Low level plots

* ``` points ``` : dot plot
* ``` lines ``` : line plot
* ``` abline ``` : straightness
* ``` polygon ``` : polygonal
* ``` legend ``` : legend (of a map, etc)
* ``` title ``` ： caption
* ``` axis ``` : axis

#### High level plots

* ``` plot ``` : Generalized Graphing Functions
* ``` pairs ``` 
* ``` coplot ``` 
* ``` qqnorm ``` 
* ``` hist ``` 
* ``` dotchart ``` 
* ``` image ``` 
* ``` contour ``` 

::: note
You can force a high level function to be converted to low level with the ``` add = TRUE ``` parameter (if available).
:::

### Graphics-related parameters (system functions) {#graphics-related-parameters}

You can use `par()` to view all the parameters current grafical device use.

::: caution
Remember to backup your default parameters before modyfy them.
:::

## Package `ggplot2` {#ggplot2}

You should know that:

1. `xy -axes` will automatically adjust based on the data you give;

1. `ggplot2` plotting results can be saved in variables and more layers can be added;

1. Layers using their own data need to be specified with ``` data = ```, while global data is not. You can just specify it via ``` ggplot(data = data.frame(...)) ```.

### Some basic parameters of `ggplot2`

::: collapse expand
1. `geom` - Layer

    `geom_<name_of_the_layer>`
      - ` geom_point ` , ` geom_line ` : A point and line plot used to reveal the relationship between two sets of data;
      - ` geom_smooth ` : Often used in conjunction with ` geom_point ` to reveal the trend of data.
      - ` geom_bar ` : bar charts
      - ` geom_boxplot ` : A box plot, used to compare N sets of data, revealing differences.
      - ` geom_path ` : similar to ` geom_line ` but can also draw other complex graphs
      - ` geom_histogram `, ` geom_density ` : Distribution of data, can also be used to compare multiple groups.

2. `scale` - Display Control

    `scale_<property_to _control>_<ways_to_control>`
      - `scale_color_...`
        - `..._gradient()`: use gradient colors for different numbers of variables and their colors.
          - `..._gradient2()`
          - `..._gradientn()`
        - `..._brewer`: use default color palettes.
      - `scale_fill_...`
        - `colour` defines the colour with which a geom is **outlined** (the shape's "stroke")
        - `fill`defines the colour with which a geom is **filled**
        - Points generally only have a `colour` and **no fill**
        - However, point shapes **21–25** that include **both** a colour and a fill.
      - `scale_shape_...`
      - `scale_size_...`
:::

### Palettes and corresponding functions in other packages {#palettes-in-other-packages}


::: collapse expand
- Included in `ggplot2`

    - `scale_color_hue`
    - `scale_color_manual`
    - `scale_color_grey`
    - `scale_colour_viridis_d`
    - `scale_color_brewer`

- From the `RColorBrewer` package

    `scale_color_brewer(palette = "<palette name>")`

- From the `viridis` package

    `scale_color_viridis(discrete=TRUE, option="<palette name>")` 

- Other packages

    - `paletteer` package: `scale_color_paletteer_xx` functions
    - `ggsci` package
    - `ggsci`: You can use it in your SCI article.
      - contents
        ` scale_color_<journal> ` and ` scale_fill_<journal> ` functions and color palettes
      - supported journals
        * NPG `scale_color_npg()`, `scale_fill_npg()`
        * AAAS, NEJM, Lancet, JAMA ... 
:::

### Aesthetic Mapping {#aesthetic-mapping}

Parameters like `size`, `colour` etc. can be inside or outside `aes()`, what is the difference?

::: note
In the internal case, the **size** is determined by the value of the specified column, or the **number** of colors and shapes is determined by the number of factors, and in the external case, the **specified value** prevails.
:::

###  Coordinate System {#coordinate-system}

::: collapse expand
1. Linear coordinate system

    * `coord_cartesian()`
      You can use parameters like `xlim()` & `ylim()` to **zoom in and out locally**.
    * `coord_flip()`
      This parameter exchanges the `x` and `y` axes.
    * `coord_fixed()`
      Draw plots in specific **aspect ratio**.

2. Nonlinear coordinate system

    * `coord_trans()`
      This parameter exchanges the `x` and `y` axes, **however**, it will plot the original figure, too.
    * `coord_polar()`
      The default parameter is `coord_polar(x)`.
    * `coord_map()`

3. `faceting` coordinate system

    `panel`, `strip`, `axis`, `tick`, `tick label`, `axis label`

    - `facet_wrap()`

      Use to specify the number of rows, columns and orientation.

      ```R
      facet_wrap(
        facets,
        nrow = NULL,
        ncol = NULL,
        scales = "fixed",
        shrink = TRUE,
        labeller = "label_value",
        as.table = TRUE,
        switch = NULL,
        drop = TRUE,
        dir = "h",
        strip.position = "top"
      )
      
      # Default parameters are listed.
      ```
:::

## Formulas and annotations {#formulas-and-annotations}

Similar to $\LaTeX$, you can just type the formula as exactly what you type in $\LaTeX$, and using `annotiate()` function to add it in your plot. 

::: note
Remember to attach the library `latex2exp`
:::

```R
fig1 =
  fig1 +
  annotate(
    "text",
    x = 25,
    y = 15,
    label = paste0("y = ", eq, "x + (", intercept, ")\n","Shaded areas are confidence intervals."), # nolint
    family = "Aptos Serif"
  ) +
labs(
    x = TeX("Position of $P_2/\\phi$"),
    y = TeX("Light Intensity/$10^{-7}$A"),
    title = TeX("Intensity of Light with Different $\\phi$")
  )
```

### Something about `hjust` and `vjust` {#hjust-and-vjust}

```R
td = expand.grid(
    hjust=c(0, 0.5, 1),
    vjust=c(0, 0.5, 1),
    angle=c(0, 45, 90),
    text="text"
)

ggplot(td, aes(x=hjust, y=vjust)) + 
    geom_point() +
    geom_text(aes(label=text, angle=angle, hjust=hjust, vjust=vjust)) + 
    facet_grid(~angle) +
    scale_x_continuous(breaks=c(0, 0.5, 1), expand=c(0, 0.2)) +
    scale_y_continuous(breaks=c(0, 0.5, 1), expand=c(0, 0.2))
```

You should always remember, the first step you want to draw a plot is to calculate the data.
